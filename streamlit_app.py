import streamlit as st
import os
import sys
import pandas as pd
import numpy as np
import yfinance as yf
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from datetime import datetime, timedelta
import time
import logging
import traceback
import random

# UI mod√ºllerini import et
try:
    # Proje dizinini sys.path'e ekle
    current_dir = os.path.dirname(os.path.abspath(__file__))
    if current_dir not in sys.path:
        sys.path.append(current_dir)
    
    # UI mod√ºllerini import et
    from ui.bist100_tab import render_bist100_tab
    from ui.ml_prediction_tab import render_ml_prediction_tab  
    from ui.stock_tab import render_stock_tab
    
    UI_MODULES_AVAILABLE = True
except ImportError as e:
    st.warning(f"UI mod√ºlleri y√ºklenemedi: {e}")
    UI_MODULES_AVAILABLE = False

# Streamlit Cloud i√ßin sayfa konfig√ºrasyonu
st.set_page_config(
    page_title="Kompakt Borsa Analiz Uygulamasƒ±",
    page_icon="üìä",
    layout="wide",
    initial_sidebar_state="expanded"
)

# Logging konfig√ºrasyonu
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Session state deƒüi≈ükenlerini ba≈ülat
if 'analyzed_stocks' not in st.session_state:
    st.session_state.analyzed_stocks = {}

if 'favorite_stocks' not in st.session_state:
    st.session_state.favorite_stocks = []

if 'analysis_history' not in st.session_state:
    st.session_state.analysis_history = []

# Yardƒ±mcƒ± fonksiyonlar
@st.cache_data(ttl=300)  # 5 dakika cache
def get_stock_data(symbol, period="1y"):
    """Hisse senedi verilerini al - Cache'li versiyon"""
    try:
        # T√ºrk hisseler i√ßin .IS ekle
        if not symbol.endswith('.IS'):
            symbol = f"{symbol}.IS"
        
        ticker = yf.Ticker(symbol)
        data = ticker.history(period=period)
        
        if data.empty:
            st.error(f"{symbol} i√ßin veri bulunamadƒ±")
            return pd.DataFrame()
        
        return data
    except Exception as e:
        logger.error(f"Veri alƒ±nƒ±rken hata: {e}")
        return pd.DataFrame()

@st.cache_data(ttl=600)  # 10 dakika cache (teknik g√∂stergeler i√ßin)
def calculate_indicators(df):
    """Temel teknik g√∂stergeleri hesapla - Cache'li versiyon"""
    if df.empty:
        return df
    
    try:
        # Hareketli ortalamalar
        df['SMA20'] = df['Close'].rolling(window=20).mean()
        df['SMA50'] = df['Close'].rolling(window=50).mean()
        df['SMA200'] = df['Close'].rolling(window=200).mean()
        
        # RSI
        delta = df['Close'].diff()
        gain = (delta.where(delta > 0, 0)).rolling(window=14).mean()
        loss = (-delta.where(delta < 0, 0)).rolling(window=14).mean()
        rs = gain / loss
        df['RSI'] = 100 - (100 / (1 + rs))
        
        # MACD
        exp1 = df['Close'].ewm(span=12).mean()
        exp2 = df['Close'].ewm(span=26).mean()
        df['MACD'] = exp1 - exp2
        df['MACD_Signal'] = df['MACD'].ewm(span=9).mean()
        
        return df
    except Exception as e:
        logger.error(f"G√∂stergeler hesaplanƒ±rken hata: {e}")
        return df

@st.cache_data(ttl=300)  # 5 dakika cache
def create_stock_chart(df, symbol):
    """Basit hisse senedi grafiƒüi olu≈ütur - Cache'li versiyon"""
    try:
        fig = make_subplots(
            rows=2, cols=1,
            shared_xaxes=True,
            vertical_spacing=0.03,
            row_heights=[0.7, 0.3],
            subplot_titles=(f"{symbol} Fiyat", "Hacim")
        )
        
        # Mum grafiƒüi
        fig.add_trace(
            go.Candlestick(
                x=df.index,
                open=df['Open'],
                high=df['High'],
                low=df['Low'],
                close=df['Close'],
                name=symbol
            ), row=1, col=1
        )
        
        # Hareketli ortalamalar
        if 'SMA20' in df.columns:
            fig.add_trace(go.Scatter(x=df.index, y=df['SMA20'], mode='lines', name='SMA20', line=dict(color='blue')), row=1, col=1)
        if 'SMA50' in df.columns:
            fig.add_trace(go.Scatter(x=df.index, y=df['SMA50'], mode='lines', name='SMA50', line=dict(color='orange')), row=1, col=1)
        
        # Hacim
        colors = ['green' if row['Close'] >= row['Open'] else 'red' for i, row in df.iterrows()]
        fig.add_trace(go.Bar(x=df.index, y=df['Volume'], name='Hacim', marker_color=colors), row=2, col=1)
        
        fig.update_layout(
            height=600,
            xaxis_rangeslider_visible=False,
            template="plotly_white"
        )
        
        return fig
    except Exception as e:
        logger.error(f"Grafik olu≈üturulurken hata: {e}")
        return go.Figure()

def get_popular_stocks():
    """Pop√ºler hisselerin listesini al"""
    popular_stocks = [
        {"symbol": "THYAO", "name": "T√ºrk Hava Yollarƒ±", "value": 250.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "GARAN", "name": "Garanti BBVA", "value": 85.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "ASELS", "name": "Aselsan", "value": 75.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "AKBNK", "name": "Akbank", "value": 55.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "EREGL", "name": "Ereƒüli Demir √áelik", "value": 40.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "VAKBN", "name": "Vakƒ±fBank", "value": 30.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "TUPRS", "name": "T√ºpra≈ü", "value": 120.0, "change_percent": random.uniform(-5, 5)},
        {"symbol": "FROTO", "name": "Ford Otosan", "value": 65.0, "change_percent": random.uniform(-5, 5)},
    ]
    return popular_stocks

# Basit Fallback Fonksiyonlarƒ± (UI mod√ºlleri y√ºklenemezse kullanƒ±lacak)
def render_simple_bist100_tab():
    """Basit BIST 100 sekmesi"""
    st.header("üìä BIST 100 Genel Bakƒ±≈ü", divider="blue")
    
    # BIST-100 verilerini al
    bist100_data = get_stock_data("XU100", "6mo")
    
    if not bist100_data.empty:
        bist100_data = calculate_indicators(bist100_data)
        
        # G√ºnl√ºk veriler
        last_price = bist100_data['Close'].iloc[-1]
        prev_price = bist100_data['Close'].iloc[-2]
        change = ((last_price - prev_price) / prev_price) * 100
        
        col1, col2, col3 = st.columns(3)
        
        with col1:
            st.metric("BIST 100", f"{last_price:.0f}", f"{change:.2f}%")
        
        with col2:
            volume = bist100_data['Volume'].iloc[-1]
            st.metric("Hacim", f"{volume:,.0f}")
        
        with col3:
            high_52w = bist100_data['High'].rolling(252).max().iloc[-1]
            st.metric("52H Y√ºksek", f"{high_52w:.0f}")
        
        # Grafik
        fig = create_stock_chart(bist100_data, "BIST-100")
        st.plotly_chart(fig, use_container_width=True)
        
        # Pop√ºler hisseler
        st.subheader("üî• Pop√ºler Hisseler")
        popular_stocks = get_popular_stocks()
        
        for i in range(0, len(popular_stocks), 4):
            cols = st.columns(4)
            for j, stock in enumerate(popular_stocks[i:i+4]):
                if j < len(cols):
                    with cols[j]:
                        change_color = "green" if stock["change_percent"] > 0 else "red"
                        st.markdown(f"""
                        **{stock['symbol']}**  
                        {stock['name']}  
                        üí∞ {stock['value']:.2f} TL  
                        <span style='color: {change_color}'>üìà {stock['change_percent']:.2f}%</span>
                        """, unsafe_allow_html=True)
    else:
        st.error("BIST-100 verileri alƒ±namadƒ±")

# Cache'li yardƒ±mcƒ± fonksiyonlar
@st.cache_data(ttl=300)  # 5 dakika cache
def analyze_stock_performance(symbol, period="1y"):
    """Hisse senedi performans analizi - Cache'li versiyon"""
    try:
        df = get_stock_data(symbol, period)
        if df.empty:
            return None
        
        df = calculate_indicators(df)
        
        # Performans metrikleri
        last_price = df['Close'].iloc[-1]
        first_price = df['Close'].iloc[0]
        total_return = ((last_price - first_price) / first_price) * 100
        
        # Volatilite
        returns = df['Close'].pct_change().dropna()
        volatility = returns.std() * (252 ** 0.5) * 100  # Yƒ±llƒ±k volatilite
        
        # Sharpe benzeri metrik
        risk_free_rate = 15  # T√ºrkiye i√ßin yakla≈üƒ±k risk-free oran
        excess_return = total_return - risk_free_rate
        sharpe_like = excess_return / volatility if volatility > 0 else 0
        
        return {
            'symbol': symbol,
            'last_price': last_price,
            'total_return': total_return,
            'volatility': volatility,
            'sharpe_like': sharpe_like,
            'df': df
        }
    except Exception as e:
        logger.error(f"Performans analizi hatasƒ±: {e}")
        return None

def render_simple_stock_tab():
    """Basit hisse analizi sekmesi"""
    st.header("üîç Hisse Senedi Teknik Analizi")
    
    col1, col2, col3 = st.columns([2, 1, 1])
    
    with col1:
        stock_symbol = st.text_input("Hisse Senedi Kodu", placeholder="√ñrnek: THYAO")
    
    with col2:
        period = st.selectbox("Zaman Aralƒ±ƒüƒ±", ["1mo", "3mo", "6mo", "1y", "2y"])
    
    with col3:
        st.write("")
        analyze = st.button("Analiz Et", use_container_width=True)
    
    if analyze and stock_symbol:
        with st.spinner(f"{stock_symbol} analiz ediliyor..."):
            df = get_stock_data(stock_symbol, period)
            
            if not df.empty:
                df = calculate_indicators(df)
                
                # Metrikler
                last_price = df['Close'].iloc[-1]
                prev_price = df['Close'].iloc[-2]
                change = ((last_price - prev_price) / prev_price) * 100
                
                col1, col2, col3, col4 = st.columns(4)
                
                with col1:
                    st.metric("Son Fiyat", f"{last_price:.2f} TL", f"{change:.2f}%")
                
                with col2:
                    rsi = df['RSI'].iloc[-1] if 'RSI' in df.columns else 0
                    st.metric("RSI", f"{rsi:.1f}")
                
                with col3:
                    volume = df['Volume'].iloc[-1]
                    st.metric("Hacim", f"{volume:,.0f}")
                
                with col4:
                    volatility = df['Close'].pct_change().std() * 100
                    st.metric("Volatilite", f"{volatility:.2f}%")
                
                # Grafik
                fig = create_stock_chart(df, stock_symbol)
                st.plotly_chart(fig, use_container_width=True)
                
                # Basit sinyal analizi
                st.subheader("üìä Teknik G√∂stergeler")
                
                col1, col2 = st.columns(2)
                
                with col1:
                    # RSI analizi
                    rsi_val = df['RSI'].iloc[-1] if 'RSI' in df.columns else 50
                    if rsi_val > 70:
                        st.warning("üî¥ RSI A≈üƒ±rƒ± Alƒ±m B√∂lgesinde (>70)")
                    elif rsi_val < 30:
                        st.success("üü¢ RSI A≈üƒ±rƒ± Satƒ±m B√∂lgesinde (<30)")
                    else:
                        st.info(f"üîµ RSI N√∂tr B√∂lgede ({rsi_val:.1f})")
                
                with col2:
                    # Trend analizi
                    if 'SMA20' in df.columns and 'SMA50' in df.columns:
                        sma20 = df['SMA20'].iloc[-1]
                        sma50 = df['SMA50'].iloc[-1]
                        if sma20 > sma50:
                            st.success("üü¢ Kƒ±sa Vadeli Y√ºkseli≈ü Trendi")
                        else:
                            st.error("üî¥ Kƒ±sa Vadeli D√º≈ü√º≈ü Trendi")
                    else:
                        st.info("Trend analizi i√ßin yeterli veri yok")
                
                # Genel deƒüerlendirme
                signals = 0
                if 'RSI' in df.columns:
                    rsi_val = df['RSI'].iloc[-1]
                    if rsi_val < 30:
                        signals += 1
                    elif rsi_val > 70:
                        signals -= 1
                
                if 'SMA20' in df.columns and 'SMA50' in df.columns:
                    if df['SMA20'].iloc[-1] > df['SMA50'].iloc[-1]:
                        signals += 1
                    else:
                        signals -= 1
                
                st.subheader("üéØ Genel Deƒüerlendirme")
                if signals > 0:
                    st.success("üü¢ Pozitif Sinyaller Aƒüƒ±rlƒ±kta")
                elif signals < 0:
                    st.error("üî¥ Negatif Sinyaller Aƒüƒ±rlƒ±kta")
                else:
                    st.info("üîµ Karƒ±≈üƒ±k Sinyaller - Dikkatli ƒ∞zleme")
                    
            else:
                st.error("Hisse verisi alƒ±namadƒ±")
    else:
        st.info("Hisse kodu girin ve analiz edin.")
        
        # √ñrnek kullanƒ±m
        st.markdown("""
        ### üí° √ñrnek Kullanƒ±m:
        - **THYAO** (T√ºrk Hava Yollarƒ±)
        - **GARAN** (Garanti BBVA)
        - **ASELS** (Aselsan)
        - **AKBNK** (Akbank)
        """)

def render_simple_ml_tab():
    """Basit ML tahmin sekmesi"""
    st.header("üß† ML Y√ºkseli≈ü Tahmini", divider="rainbow")
    
    st.markdown("""
    Bu b√∂l√ºm, makine √∂ƒürenmesi algoritmalarƒ± kullanarak hisse senetlerinin gelecekteki performansƒ±nƒ± tahmin eder.
    
    **üéØ Nasƒ±l √áalƒ±≈üƒ±r:**
    - Teknik g√∂stergeler ve fiyat hareketleri analiz edilir
    - Ge√ßmi≈ü verilerden √∂ƒürenme yapƒ±lƒ±r
    - Gelecekteki y√ºkseli≈ü olasƒ±lƒ±ƒüƒ± hesaplanƒ±r
    
    **‚ö†Ô∏è √ñnemli Not:** Bu tahminler yatƒ±rƒ±m tavsiyesi deƒüildir, sadece analiz ama√ßlƒ±dƒ±r.
    """)
    
    # Parametreler
    col1, col2, col3 = st.columns(3)
    
    with col1:
        threshold = st.slider("Y√ºkseli≈ü E≈üiƒüi (%)", 1.0, 10.0, 3.0, 0.5)
    
    with col2:
        scan_option = st.selectbox("Tarama Modu", ["BIST 30", "Pop√ºler Hisseler", "√ñzel Liste"])
    
    with col3:
        days = st.selectbox("Tahmin S√ºresi (G√ºn)", [1, 3, 5, 7], index=2)
    
    # √ñzel liste i√ßin
    if scan_option == "√ñzel Liste":
        custom_stocks = st.text_area("Hisse Kodlarƒ± (virg√ºlle ayƒ±rƒ±n)", 
                                   placeholder="THYAO, GARAN, ASELS")
        stock_list = [s.strip().upper() for s in custom_stocks.split(",") if s.strip()]
    elif scan_option == "BIST 30":
        stock_list = ["THYAO", "GARAN", "ASELS", "AKBNK", "EREGL", "VAKBN", "TUPRS", "FROTO", 
                     "TCELL", "SAHOL", "PETKM", "KCHOL", "KOZAL", "ARCLK"]
    else:  # Pop√ºler Hisseler
        stock_list = ["THYAO", "GARAN", "ASELS", "AKBNK", "EREGL"]
    
    if st.button("üöÄ ML Tarama Ba≈ülat", type="primary", use_container_width=True):
        if not stock_list:
            st.error("Taranacak hisse listesi bo≈ü!")
            return
        
        results = []
        progress_bar = st.progress(0)
        status_text = st.empty()
        
        for i, symbol in enumerate(stock_list):
            status_text.text(f"üîÑ Analiz ediliyor: {symbol}")
            progress_bar.progress((i + 1) / len(stock_list))
            
            try:
                # Veri al
                df = get_stock_data(symbol, "1y")
                if df.empty:
                    continue
                
                # Basit ML analizi (ger√ßek ML yerine basit istatistiksel analiz)
                df = calculate_indicators(df)
                
                # Son fiyat ve deƒüi≈üim
                last_price = df['Close'].iloc[-1]
                prev_price = df['Close'].iloc[-2]
                change = ((last_price - prev_price) / prev_price) * 100
                
                # Basit y√ºkseli≈ü olasƒ±lƒ±ƒüƒ± hesaplama
                # RSI, trend ve volatilite bazlƒ±
                score = 0
                
                # RSI skoru
                if 'RSI' in df.columns:
                    rsi = df['RSI'].iloc[-1]
                    if rsi < 30:  # Oversold
                        score += 30
                    elif rsi < 50:
                        score += 15
                    elif rsi > 70:  # Overbought
                        score -= 20
                
                # Trend skoru
                if 'SMA20' in df.columns and 'SMA50' in df.columns:
                    sma20 = df['SMA20'].iloc[-1]
                    sma50 = df['SMA50'].iloc[-1]
                    if sma20 > sma50:
                        score += 25
                    else:
                        score -= 15
                
                # Momentum skoru
                if len(df) >= 5:
                    momentum = (df['Close'].iloc[-1] / df['Close'].iloc[-5] - 1) * 100
                    if momentum > 2:
                        score += 20
                    elif momentum < -2:
                        score -= 20
                
                # Skor normalizasyonu (0-100 arasƒ±)
                probability = max(0, min(100, score + 50)) / 100
                
                results.append({
                    "Hisse": symbol,
                    "Son Fiyat": f"{last_price:.2f} TL",
                    "G√ºnl√ºk Deƒüi≈üim": f"{change:.2f}%",
                    "Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±": f"{probability:.1%}",
                    "Durum": "üü¢ Umutvar" if probability > 0.6 else ("üü° N√∂tr" if probability > 0.4 else "üî¥ Zayƒ±f")
                })
                
            except Exception as e:
                logger.error(f"{symbol} i√ßin hata: {e}")
                continue
        
        progress_bar.empty()
        status_text.empty()
        
        if results:
            # Sonu√ßlarƒ± g√∂ster
            df_results = pd.DataFrame(results)
            df_results = df_results.sort_values("Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±", ascending=False)
            
            st.subheader("üìä ML Tarama Sonu√ßlarƒ±")
            st.dataframe(df_results, use_container_width=True)
            
            # En umutvar 3 hisse
            st.subheader("üèÜ En Umutvar 3 Hisse")
            top_3 = df_results.head(3)
            
            for i, (_, row) in enumerate(top_3.iterrows(), 1):
                if float(row['Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±'].strip('%')) > 60:
                    st.success(f"**{i}. {row['Hisse']}** - {row['Son Fiyat']} - Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±: {row['Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±']}")
                else:
                    st.info(f"**{i}. {row['Hisse']}** - {row['Son Fiyat']} - Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±: {row['Y√ºkseli≈ü Olasƒ±lƒ±ƒüƒ±']}")
        else:
            st.error("‚ùå Hi√ß sonu√ß alƒ±namadƒ±. L√ºtfen farklƒ± parametreler deneyin.")
    
    # Nasƒ±l √ßalƒ±≈üƒ±r a√ßƒ±klamasƒ±
    with st.expander("üîç Nasƒ±l √áalƒ±≈üƒ±yor?"):
        st.markdown("""
        ### üßÆ Analiz S√ºreci:
        
        1. **üìà Teknik Analiz**: RSI, hareketli ortalamalar ve momentum hesaplanƒ±r
        2. **üìä Skorlama**: Her g√∂sterge i√ßin pozitif/negatif puanlar verilir  
        3. **üéØ Olasƒ±lƒ±k**: Toplam skor 0-100% arasƒ±nda normalize edilir
        4. **üìã Sƒ±ralama**: En y√ºksek olasƒ±lƒ±ktan d√º≈ü√ºƒüe doƒüru sƒ±ralanƒ±r
        
        ### üìä Yorumlama:
        - **üü¢ >60%**: G√º√ßl√º y√ºkseli≈ü potansiyeli
        - **üü° 40-60%**: Belirsiz durum
        - **üî¥ <40%**: Zayƒ±f y√ºkseli≈ü potansiyeli
        
        ### ‚ö†Ô∏è √ñnemli Uyarƒ±lar:
        - Bu tahminler **garanti deƒüildir**
        - **Yatƒ±rƒ±m tavsiyesi niteliƒüi ta≈üƒ±maz**
        - Kendi ara≈ütƒ±rmanƒ±zƒ± da yapƒ±n
        - **Risk y√∂netimini** ihmal etmeyin
        """)

def main():
    """Ana uygulama"""
    
    # CSS stilleri
    st.markdown("""
    <style>
        .main-header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
            color: white;
        }
        
        .main-header h1 {
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 2.2rem;
        }
        
        .main-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0;
        }
        
        .stTabs [data-baseweb="tab-list"] {
            gap: 8px;
        }
        
        .stTabs [data-baseweb="tab"] {
            height: 50px;
            padding-left: 20px;
            padding-right: 20px;
            background-color: #f0f2f6;
            border-radius: 10px 10px 0px 0px;
            font-weight: 600;
        }
        
        .stTabs [aria-selected="true"] {
            background-color: #667eea;
            color: white;
        }
    </style>
    """, unsafe_allow_html=True)
    
    # Ana ba≈ülƒ±k
    st.markdown('''
    <div class="main-header">
        <h1>üìä Kompakt Borsa Analiz Uygulamasƒ±</h1>
        <p>BIST 100 ‚Ä¢ ML Tarama ‚Ä¢ Hisse Analizi</p>
    </div>
    ''', unsafe_allow_html=True)
    
    # Ana sekmeler - ƒ∞stediƒüiniz 3 sekme
    tab1, tab2, tab3 = st.tabs(["üìä BIST 100", "üß† ML Tarama", "üîç Hisse Analizi"])
    
    with tab1:
        if UI_MODULES_AVAILABLE:
            try:
                render_bist100_tab()
            except Exception as e:
                st.error(f"BIST100 mod√ºl√º hatasƒ±: {e}")
                render_simple_bist100_tab()
        else:
            render_simple_bist100_tab()
    
    with tab2:
        if UI_MODULES_AVAILABLE:
            try:
                render_ml_prediction_tab()
            except Exception as e:
                st.error(f"ML mod√ºl√º hatasƒ±: {e}")
                render_simple_ml_tab()
        else:
            render_simple_ml_tab()
    
    with tab3:
        if UI_MODULES_AVAILABLE:
            try:
                render_stock_tab()
            except Exception as e:
                st.error(f"Stock mod√ºl√º hatasƒ±: {e}")
                render_simple_stock_tab()
        else:
            render_simple_stock_tab()
    
    # Sidebar
    with st.sidebar:
        st.title("üìä Piyasa √ñzeti")
        
        # BIST-100 √∂zet
        try:
            bist_data = get_stock_data("XU100", "5d")
            if not bist_data.empty:
                last_price = bist_data['Close'].iloc[-1]
                prev_price = bist_data['Close'].iloc[-2]
                change = ((last_price - prev_price) / prev_price) * 100
                
                st.metric("BIST 100", f"{last_price:.0f}", f"{change:.2f}%")
        except:
            st.info("BIST 100 verisi y√ºklenemedi")
        
        # Pop√ºler hisseler
        st.subheader("üî• Pop√ºler Hisseler")
        popular_stocks = get_popular_stocks()[:5]
        
        for stock in popular_stocks:
            change_color = "green" if stock["change_percent"] > 0 else "red"
            st.markdown(f"""
            **{stock['symbol']}**  
            <span style='color: {change_color}'>{stock['change_percent']:.2f}%</span>
            """, unsafe_allow_html=True)
        
        st.markdown("---")
        
        # Bilgilendirme
        st.markdown("""
        ### ‚ÑπÔ∏è Bilgilendirme
        
        Bu uygulama sadece **eƒüitim ve analiz** ama√ßlƒ±dƒ±r.
        
        **‚ö†Ô∏è Yatƒ±rƒ±m tavsiyesi deƒüildir!**
        
        Yatƒ±rƒ±m kararlarƒ±nƒ±zƒ± almadan √∂nce:
        - Detaylƒ± ara≈ütƒ±rma yapƒ±n
        - Profesyonel danƒ±≈ümanlƒ±k alƒ±n
        - Risk y√∂netimini g√∂zetin
        """)

if __name__ == "__main__":
    main()
